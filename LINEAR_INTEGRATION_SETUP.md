# Linear Integration Setup Guide üé´

## What You Need to Provide

To enable **real Linear ticket creation** instead of mock JSON files, you need to provide these credentials:

### 1. üîë **Linear API Key** (Required)
- **What:** Your personal Linear API token
- **Where to get it:** Linear Settings ‚Üí API ‚Üí Personal API keys
- **Permissions needed:** `write` access to create issues

### 2. üè¢ **Linear Team Key** (Required)
- **What:** Your team's identifier in Linear (e.g., "ENG", "FTS", "DEV")
- **Where to find it:** Look at any Linear ticket URL: `https://linear.app/yourteam/issue/TEAM-123`
- **Example:** If your tickets look like `ENG-123`, your team key is `ENG`

## Step-by-Step Setup

### Step 1: Get Your Linear API Key
1. Go to [Linear Settings ‚Üí API](https://linear.app/settings/api)
2. Click "Create new token"
3. Give it a name like "RCA Agent"
4. Select scopes: **`write`** (to create issues)
5. Copy the generated token (starts with `lin_api_...`)

### Step 2: Find Your Team Key
1. Go to any Linear issue in your workspace
2. Look at the URL: `https://linear.app/yourworkspace/issue/TEAMKEY-123`
3. The `TEAMKEY` part is what you need (e.g., `ENG`, `FTS`, `DEV`)

### Step 3: Configure Environment
Create a `.env` file in your project root:

```bash
# Copy .env.example to .env
cp .env.example .env
```

Edit `.env` file:
```bash
# Your Linear API token (starts with lin_api_...)
LINEAR_API_KEY=lin_api_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# Your team key (e.g., ENG, FTS, DEV)
LINEAR_TEAM_KEY=ENG
```

### Step 4: Install Dependencies
```bash
pip install python-dotenv requests
```

## What Happens When Configured

### ‚úÖ **With Linear API Key** (Real Integration)
- Creates actual Linear tickets in your workspace
- Returns real ticket ID (e.g., `ENG-1234`)
- Returns real Linear URL
- Ticket appears in your Linear workspace immediately
- Team members get notified (if configured)

### ‚ùå **Without Linear API Key** (Mock Mode)
- Creates JSON files in `linear_mock/` directory
- Returns mock ticket ID (e.g., `FTS-1234`)
- Returns mock Linear URL
- No actual ticket created

## Example Ticket Creation

When you run the RCA Agent with Linear integration:

```bash
# This will create a REAL Linear ticket
python -m rca.cli ticket incidents/TCK-1001.json --team ENG
```

**Output with real integration:**
```json
{
  "success": true,
  "ticket_id": "ENG-1234",
  "ticket_url": "https://linear.app/yourworkspace/issue/ENG-1234",
  "type": "real",
  "message": "Created Linear ticket: ENG-1234"
}
```

## Ticket Content

The created Linear ticket will include:

### üìã **Title**
```
[RCA] TCK-1001 - Checkout intermittently timing out
```

### üìù **Description**
```markdown
## Incident: TCK-1001

### Summary
Checkout flow experiencing 3% failure rate due to payment gateway timeouts exceeding 5 seconds without proper handling.

### Root Cause Analysis
**Suspect Code:** `repo-orders/src/orders/checkout.ts`

### Key Findings
- **Business Logic:** Missing timeout guard - Violates Checkout PRD (5s SLA requirement)
- **Code Quality:** Missing error context - No request_id/user_id in logs

### Next Steps
- [ ] Review proposed fixes in RCA document
- [ ] Implement timeout guard and retry logic
- [ ] Add safe dictionary access patterns
- [ ] Update tests and validation
- [ ] Deploy and monitor

### Links
- Initial RCA document (see `out/` directory)
- PR draft (see `out/` directory)

_This ticket was auto-generated by RCA Agent_
```

### üè∑Ô∏è **Labels**
- `rca`
- `bug` 
- `auto-generated`

### ‚ö° **Priority**
- **High** (1) - for business logic issues
- **Medium** (2) - for code quality issues

## Testing Your Setup

### Test 1: Check Configuration
```bash
python -c "
from rca.linear_client import load_linear_config
config = load_linear_config()
print('API Key:', 'SET' if config['api_key'] else 'NOT SET')
print('Team Key:', config['team_key'])
"
```

### Test 2: Create Test Ticket
```bash
# Run the demo and create a ticket
python -m rca.cli demo incidents/TCK-1001.json
```

### Test 3: Verify in Linear
1. Go to your Linear workspace
2. Check for new ticket with title `[RCA] TCK-1001 - ...`
3. Verify it has the correct team, labels, and description

## Troubleshooting

### ‚ùå **"Linear API error: Invalid token"**
- Check your API key is correct
- Ensure it starts with `lin_api_`
- Verify the token has `write` permissions

### ‚ùå **"Team not found"**
- Check your `LINEAR_TEAM_KEY` matches your actual team key
- Look at existing ticket URLs to find the correct team key

### ‚ùå **"Permission denied"**
- Your API token needs `write` access
- Regenerate token with correct permissions

### ‚ùå **Still creating JSON files**
- Check `.env` file exists in project root
- Verify `LINEAR_API_KEY` is set (not empty)
- Restart your application after setting environment variables

## Security Notes

üîí **Keep your API key secure:**
- Never commit `.env` file to git (it's in `.gitignore`)
- Don't share your API key in screenshots or logs
- Regenerate if compromised

## Ready to Go!

Once configured, your RCA Agent will:
1. ‚úÖ Create real Linear tickets instead of JSON files
2. ‚úÖ Integrate with your team's workflow
3. ‚úÖ Provide clickable ticket URLs
4. ‚úÖ Auto-assign appropriate priority and labels
5. ‚úÖ Include comprehensive incident details

**Need help?** Check the troubleshooting section above or verify your Linear workspace permissions.
